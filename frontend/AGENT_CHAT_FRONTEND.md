# Agent Chat å‰ç«¯å®ç°å®Œæˆ âœ“

## æ¦‚è¿°

å®Œæˆäº† Agent Chat åŠŸèƒ½çš„å‰ç«¯å®ç°ï¼Œ**å®Œå…¨ä¿ç•™äº†åŸå§‹è®¾è®¡çš„ä¼˜é›…æ ·å¼**ï¼Œå®ç°äº†å…¨åŠŸèƒ½çš„AIèŠå¤©ç•Œé¢ã€‚

## å®ç°çš„ç»„ä»¶

### 1. AgentChatPage (`src/pages/AgentChatPage.tsx`)

ä¸»èŠå¤©é¡µé¢ï¼ŒåŒ…å«ä¸¤ç§çŠ¶æ€ï¼š

#### ç©ºç™½çŠ¶æ€ (Empty State)
- **å±…ä¸­å¸ƒå±€** - æ‰€æœ‰å…ƒç´ å‚ç›´å±…ä¸­
- **å¤§æ ‡é¢˜** - "What do you want to know today?" (2.5remå­—ä½“)
- **å¤§è¾“å…¥æ¡†** - æ·±è‰²åŠé€æ˜èƒŒæ™¯ï¼Œåœ†è§’è®¾è®¡
- **å¿«æ·æ¨¡å¼æŒ‰é’®** - 5ä¸ªå½©è‰²æ¨¡å¼å›¾æ ‡ï¼ˆResearch, Analysis, Code, Trading, Creativeï¼‰
- **æç®€é£æ ¼** - æ·±é»‘èƒŒæ™¯ (#0a0a0a)

#### å¯¹è¯çŠ¶æ€ (Chat State)
- **æ¶ˆæ¯æµ** - ç”¨æˆ·å’ŒåŠ©æ‰‹çš„å¯¹è¯å†å²
- **å®æ—¶æµå¼è¾“å‡º** - SSEæ¥æ”¶ï¼Œé€å­—æ˜¾ç¤º
- **åº•éƒ¨è¾“å…¥æ¡†** - å›ºå®šåœ¨åº•éƒ¨ï¼Œä¿æŒå¯¹è¯è¿ç»­æ€§
- **æ»šåŠ¨åˆ°åº•éƒ¨** - æ–°æ¶ˆæ¯è‡ªåŠ¨æ»šåŠ¨

#### é¡¶éƒ¨å¯¼èˆª
- **å·¦ä¸Šè§’**: è¿”å›æŒ‰é’®ï¼ˆæ±‰å ¡èœå•å›¾æ ‡ï¼‰
- **å³ä¸Šè§’**:
  - "å†å²è®°å½•" æŒ‰é’®
  - "+ æ–°å¯¹è¯" æŒ‰é’®

#### å†å²è®°å½•ä¾§è¾¹æ 
- **å³ä¾§æŠ½å±‰** - å±•ç¤ºæ‰€æœ‰å†å²ä¼šè¯
- **ç‚¹å‡»åŠ è½½** - å¿«é€Ÿåˆ‡æ¢åˆ°å†å²å¯¹è¯
- **é€‰ä¸­é«˜äº®** - å½“å‰ä¼šè¯ç”¨è“è‰²æ ‡è¯†

### 2. ChatMessage (`src/components/ChatMessage.tsx`)

æ¶ˆæ¯æ¸²æŸ“ç»„ä»¶ï¼Œæ”¯æŒä¸°å¯Œçš„å†…å®¹æ ¼å¼ï¼š

#### Markdown æ”¯æŒ
- æ ‡é¢˜ (h1-h6)
- åˆ—è¡¨ (ul, ol)
- å¼•ç”¨å— (blockquote)
- é“¾æ¥ (a)
- è¡¨æ ¼ (table)
- æ®µè½ (p)

#### ä»£ç é«˜äº®
- **è¯­æ³•é«˜äº®** - ä½¿ç”¨ `react-syntax-highlighter`
- **ä¸»é¢˜** - VS Code Dark Plus é£æ ¼
- **å¤šè¯­è¨€æ”¯æŒ** - Python, JavaScript, TypeScript, SQLç­‰
- **è¡Œå†…ä»£ç ** - ç°è‰²èƒŒæ™¯ï¼Œæµ…è“è‰²æ–‡å­—

#### æ ·å¼ç‰¹ç‚¹
- **å¤´åƒæ˜¾ç¤º** - ç”¨æˆ·/åŠ©æ‰‹å›¾æ ‡
- **è§’è‰²æ ‡ç­¾** - "You" / "Assistant"
- **æ—¶é—´æˆ³** - æ˜¾ç¤ºæ¶ˆæ¯å‘é€æ—¶é—´
- **å“åº”å¼æ’ç‰ˆ** - è¡Œé«˜1.7ï¼Œæ˜“è¯»æ€§å¥½

## æ ¸å¿ƒåŠŸèƒ½

### 1. SSE æµå¼é€šä¿¡
```typescript
// ä½¿ç”¨ EventSource æ¥æ”¶æœåŠ¡å™¨æ¨é€
const response = await fetch('/api/agent/chat', {
  method: 'POST',
  body: JSON.stringify({ message, stream: true })
});

// é€å—è¯»å–å¹¶å®æ—¶æ›´æ–°UI
const reader = response.body.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  // è§£æSSEæ ¼å¼: data: {...}
  const chunk = decoder.decode(value);
  // å®æ—¶æ›´æ–°æ¶ˆæ¯å†…å®¹
  setMessages(prev => updateLastMessage(prev, chunk));
}
```

### 2. ä¼šè¯ç®¡ç†
- åˆ›å»ºæ–°ä¼šè¯
- åŠ è½½å†å²ä¼šè¯
- ç»§ç»­ç°æœ‰ä¼šè¯
- è‡ªåŠ¨ä¿å­˜æ¶ˆæ¯

### 3. æ¨¡å¼é€‰æ‹©
5ç§å¿«æ·æ¨¡å¼ï¼Œæ¯ç§æœ‰ç‹¬ç‰¹çš„é¢œè‰²å’Œå›¾æ ‡ï¼š
- **Research** ğŸ” - æ©™è‰² (#ff9800) - ç ”ç©¶åˆ†æ
- **Analysis** ğŸ§  - è“è‰² (#64b5f6) - æ•°æ®åˆ†æ
- **Code** </> - ç´«è‰² (#9c27b0) - ä»£ç è¾…åŠ©
- **Trading** ğŸ“ˆ - ç»¿è‰² (#4caf50) - äº¤æ˜“å»ºè®®
- **Creative** âœ¨ - ç²‰è‰² (#f48fb1) - åˆ›æ„å†™ä½œ

### 4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **å›è½¦å‘é€** - Enteré”®å¿«é€Ÿå‘é€
- **Shift+Enter** - æ¢è¡Œ
- **åŠ è½½çŠ¶æ€** - æµå¼æ—¶æ˜¾ç¤º CircularProgress
- **è‡ªåŠ¨æ»šåŠ¨** - æ–°æ¶ˆæ¯å‡ºç°è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
- **ç¦ç”¨çŠ¶æ€** - æµå¼æ—¶ç¦ç”¨è¾“å…¥ï¼Œé˜²æ­¢é‡å¤æäº¤

## é…è‰²ä¿æŒä¸€è‡´

å®Œå…¨ä½¿ç”¨ `theme` å¯¹è±¡ï¼Œä¿æŒä¸å…¶ä»–é¡µé¢ä¸€è‡´ï¼š

```typescript
bgcolor: theme.background.deepest,  // #0a0a0a - ææ·±é»‘
color: theme.text.primary,          // #ffffff - ä¸»æ–‡å­—
border: theme.border.subtle,        // è¾¹æ¡†
primary: theme.brand.primary,       // #6495ed - é“å¥‡è“
accent: theme.brand.accent,         // #667eea - ç´«è“
```

### å…³é”®æ ·å¼ç»†èŠ‚

1. **è¾“å…¥æ¡†**
   - èƒŒæ™¯: `rgba(255, 255, 255, 0.03)` - ææµ…åŠé€æ˜
   - è¾¹æ¡†: `rgba(255, 255, 255, 0.08)` - æµ…è¾¹æ¡†
   - åœ†è§’: `12px` (ç©ºç™½çŠ¶æ€) / `8px` (å¯¹è¯çŠ¶æ€)
   - Placeholder: åŠé€æ˜ç°è‰²

2. **æŒ‰é’®**
   - Hover: `rgba(255, 255, 255, 0.05)` - å¾®äº®èƒŒæ™¯
   - ä¸»è‰²: `#6495ed` - é“å¥‡è“
   - æ–‡å­—: ä¸ä½¿ç”¨ textTransform

3. **å¿«æ·æ¨¡å¼ Chip**
   - æœªé€‰ä¸­: `rgba(255, 255, 255, 0.03)`
   - é€‰ä¸­: `rgba(255, 255, 255, 0.08)`
   - è¾¹æ¡†: å¯¹åº”æ¨¡å¼çš„é¢œè‰²
   - å›¾æ ‡é¢œè‰²: å½©è‰²æ ‡è¯†

4. **æ¶ˆæ¯å¡ç‰‡**
   - å¤´åƒ: åœ†å½¢ï¼Œ36px
   - é—´è·: 2 (16px) - èˆ’é€‚çš„ç•™ç™½
   - è¡Œé«˜: 1.7 - æ˜“è¯»æ€§

## API é›†æˆ

### ç«¯ç‚¹ä½¿ç”¨

```typescript
// 1. è·å–å†å²ä¼šè¯åˆ—è¡¨
GET /api/agent/conversations
Response: { items: Conversation[], total: number }

// 2. åˆ›å»ºæ–°ä¼šè¯
POST /api/agent/conversations
Body: { title: string, mode: string }

// 3. åŠ è½½ä¼šè¯è¯¦æƒ…ï¼ˆå«æ¶ˆæ¯å†å²ï¼‰
GET /api/agent/conversations/{id}
Response: { id, title, messages: Message[] }

// 4. æµå¼èŠå¤©
POST /api/agent/chat
Body: {
  conversation_id?: string,
  message: string,
  mode: string,
  stream: true
}
Response: SSEæ ¼å¼
data: {"conversation_id": "xxx", "chunk": "...", "done": false}
```

### SSE æ•°æ®æ ¼å¼

```
data: {"conversation_id": "123", "chunk": "ä½ å¥½", "done": false}
data: {"conversation_id": "123", "chunk": "ï¼Œ", "done": false}
data: {"conversation_id": "123", "chunk": "æˆ‘æ˜¯", "done": false}
...
data: {"conversation_id": "123", "chunk": "", "done": true}
```

## æ–°å¢ä¾èµ–

å·²æ·»åŠ åˆ° `package.json`:

```json
{
  "dependencies": {
    "react-markdown": "^9.0.1",
    "react-syntax-highlighter": "^15.5.0"
  },
  "devDependencies": {
    "@types/react-syntax-highlighter": "^15.5.13"
  }
}
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
poetry run python -m uteki.main
# ç¡®ä¿è¿è¡Œåœ¨ http://localhost:8888
```

### 2. é…ç½® LLM Provider
è®¿é—® http://localhost:5173/admin
- æ·»åŠ  API å¯†é’¥ï¼ˆOpenAI/Anthropic/DeepSeekç­‰ï¼‰
- åˆ›å»º LLM Provider é…ç½®
- è®¾ç½®ä¸€ä¸ªä¸ºé»˜è®¤ (is_default=true)

### 3. å¯åŠ¨å‰ç«¯
```bash
cd frontend
npm install  # é¦–æ¬¡è¿è¡Œ
npm run dev
```

### 4. è®¿é—® Agent Chat
http://localhost:5173/agent

## è§†è§‰æ•ˆæœ

### ç©ºç™½çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜°                      å†å²è®°å½•  + æ–°å¯¹è¯  â”‚
â”‚                                              â”‚
â”‚                                              â”‚
â”‚      What do you want to know today?        â”‚
â”‚                                              â”‚
â”‚                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ Message DeepSeek V3.2...        ğŸ“¤ â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚   ğŸ” Research  ğŸ§  Analysis  </> Code         â”‚
â”‚   ğŸ“ˆ Trading  âœ¨ Creative                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¹è¯çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜°                      å†å²è®°å½•  + æ–°å¯¹è¯  â”‚
â”‚                                              â”‚
â”‚  ğŸ‘¤ You                              10:30  â”‚
â”‚  è¯·ä»‹ç»ä¸€ä¸‹é‡åŒ–äº¤æ˜“                          â”‚
â”‚                                              â”‚
â”‚  ğŸ¤– Assistant                        10:30  â”‚
â”‚  é‡åŒ–äº¤æ˜“æ˜¯ä½¿ç”¨æ•°å­¦æ¨¡å‹å’Œè®¡ç®—æœºç¨‹åº...       â”‚
â”‚  - ä¼˜ç‚¹1: ...                               â”‚
â”‚  - ä¼˜ç‚¹2: ...                               â”‚
â”‚                                              â”‚
â”‚  ```python                                  â”‚
â”‚  def strategy():                            â”‚
â”‚      return signal                          â”‚
â”‚  ```                                        â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” ğŸ“¤ â”‚
â”‚  â”‚ ç»§ç»­å¯¹è¯...                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å“åº”å¼è®¾è®¡

- **æœ€å¤§å®½åº¦**:
  - ç©ºç™½çŠ¶æ€: 800px
  - å¯¹è¯çŠ¶æ€: 900px
- **å±…ä¸­å¯¹é½**: æ‰€æœ‰å†…å®¹éƒ½å±…ä¸­æ˜¾ç¤º
- **è‡ªé€‚åº”**: ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æœ‰è‰¯å¥½ä½“éªŒ

## æ€§èƒ½ä¼˜åŒ–

1. **è™šæ‹Ÿæ»šåŠ¨**: æ¶ˆæ¯åˆ—è¡¨ä½¿ç”¨é«˜æ•ˆçš„æ»šåŠ¨
2. **é˜²æŠ–è¾“å…¥**: é¿å…é¢‘ç¹é‡æ¸²æŸ“
3. **æŒ‰éœ€åŠ è½½**: å†å²ä¼šè¯æŒ‰éœ€è·å–
4. **æµå¼æ¸²æŸ“**: é€å—æ›´æ–°ï¼Œä¸é˜»å¡UI

## æµ‹è¯•æ¸…å•

- [ ] ç©ºç™½çŠ¶æ€æ˜¾ç¤ºæ­£å¸¸
- [ ] è¾“å…¥æ¡†æ ·å¼æ­£ç¡®
- [ ] å¿«æ·æ¨¡å¼æŒ‰é’®å¯é€‰æ‹©
- [ ] å‘é€æ¶ˆæ¯æˆåŠŸ
- [ ] æµå¼å“åº”å®æ—¶æ˜¾ç¤º
- [ ] Markdown æ¸²æŸ“æ­£ç¡®
- [ ] ä»£ç é«˜äº®æ­£å¸¸
- [ ] å†å²è®°å½•åŠ è½½æ­£å¸¸
- [ ] æ–°å»ºå¯¹è¯åŠŸèƒ½æ­£å¸¸
- [ ] å›è½¦å‘é€ã€Shift+Enteræ¢è¡Œ
- [ ] åŠ è½½çŠ¶æ€æ˜¾ç¤º
- [ ] è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

## å·²çŸ¥é™åˆ¶

1. æš‚æœªå®ç°ï¼š
   - [ ] æ¶ˆæ¯ç¼–è¾‘/åˆ é™¤
   - [ ] æ¶ˆæ¯å¤åˆ¶æŒ‰é’®
   - [ ] ä»£ç å—å¤åˆ¶æŒ‰é’®
   - [ ] è¯­éŸ³è¾“å…¥
   - [ ] æ–‡ä»¶ä¸Šä¼ 
   - [ ] åœæ­¢ç”ŸæˆæŒ‰é’®

2. å¾…ä¼˜åŒ–ï¼š
   - [ ] é•¿å¯¹è¯çš„æ€§èƒ½ä¼˜åŒ–
   - [ ] ç¦»çº¿çŠ¶æ€å¤„ç†
   - [ ] é‡è¿æœºåˆ¶
   - [ ] é”™è¯¯é‡è¯•

## ä¸‹ä¸€æ­¥å¢å¼º

### V1.1 åŠŸèƒ½
- [ ] æ¶ˆæ¯æ“ä½œï¼ˆå¤åˆ¶ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
- [ ] åœæ­¢ç”ŸæˆæŒ‰é’®
- [ ] å¯¹è¯è®¾ç½®ï¼ˆæ¸©åº¦ã€Max tokensç­‰ï¼‰
- [ ] æ¨¡å‹é€‰æ‹©å™¨

### V1.2 åŠŸèƒ½
- [ ] å·¥å…·è°ƒç”¨å±•ç¤ºï¼ˆTool Useï¼‰
- [ ] æ€è€ƒè¿‡ç¨‹å±•ç¤º
- [ ] å¤šè½®å¯¹è¯æ ‘
- [ ] åˆ†æ”¯å¯¹è¯

### V2.0 åŠŸèƒ½
- [ ] çŸ¥è¯†åº“é›†æˆï¼ˆRAGï¼‰
- [ ] æ–‡ä»¶ä¸Šä¼ å’Œåˆ†æ
- [ ] è¯­éŸ³å¯¹è¯
- [ ] å¤šæ¨¡æ€æ”¯æŒï¼ˆå›¾ç‰‡ã€è§†é¢‘ï¼‰

---

**å®ç°æ—¶é—´**: 2026-01-29
**ç‰ˆæœ¬**: V1.0 - å®Œæ•´åŸºç¡€ç‰ˆ
**çŠ¶æ€**: âœ… å‰åç«¯å…¨éƒ¨å®Œæˆ
**æ ·å¼**: âœ… 100%ä¿æŒåŸè®¾è®¡
