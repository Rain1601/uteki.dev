# Dashboard Domain Specification（仪表板域规格说明）

**Domain**: 交易历史与性能可视化
**Owner**: Dashboard Module
**Last Updated**: 2026-01-26

---

## ADDED Requirements（新增需求）

### Requirement: 交易历史展示

系统应当展示完整的交易历史记录，支持筛选和搜索。

#### Scenario: 用户查看交易历史
- **WHEN** 用户打开仪表板页面
- **THEN** 系统从ClickHouse查询最近的交易记录
- **THEN** 系统按时间倒序显示交易列表
- **THEN** 每条记录显示：时间、交易对、方向、数量、价格、盈亏
- **THEN** 系统实现分页（每页50条）

#### Scenario: 用户筛选按日期范围
- **WHEN** 用户选择日期范围（例如：最近7天）
- **THEN** 系统应用时间过滤条件
- **THEN** 系统重新查询ClickHouse
- **THEN** 系统显示筛选后的结果
- **THEN** 系统更新统计数据

#### Scenario: 用户筛选按交易对
- **WHEN** 用户在筛选器中选择"BTC-USDT"
- **THEN** 系统仅显示BTC-USDT交易
- **THEN** 系统更新相关统计指标
- **THEN** 系统保持筛选状态

#### Scenario: 用户筛选按盈亏状态
- **WHEN** 用户筛选"仅盈利"交易
- **THEN** 系统过滤掉亏损交易
- **THEN** 系统显示盈利交易列表
- **THEN** 系统显示总盈利金额

#### Scenario: 用户搜索特定订单
- **WHEN** 用户输入订单ID搜索
- **THEN** 系统在ClickHouse中全文搜索
- **THEN** 系统返回匹配的订单
- **THEN** 系统高亮搜索关键词

---

### Requirement: 性能指标概览

系统应当展示关键性能指标（KPI）的实时概览。

#### Scenario: 显示总收益率
- **WHEN** 用户查看仪表板
- **THEN** 系统计算所有已平仓位的总盈亏
- **THEN** 系统计算收益率百分比
- **THEN** 系统显示绝对金额和百分比
- **THEN** 系统用颜色指示盈亏（绿色=盈利，红色=亏损）

#### Scenario: 显示胜率
- **WHEN** 系统计算统计数据
- **THEN** 系统统计盈利交易数量
- **THEN** 系统统计总交易数量
- **THEN** 系统计算胜率 = 盈利交易数 / 总交易数
- **THEN** 系统显示百分比和绝对数量

#### Scenario: 显示最大回撤
- **WHEN** 系统分析权益曲线
- **THEN** 系统识别历史最高点
- **THEN** 系统识别后续最低点
- **THEN** 系统计算最大回撤百分比
- **THEN** 系统标注回撤发生的时间段

#### Scenario: 显示夏普比率
- **WHEN** 系统评估风险调整后收益
- **THEN** 系统计算日收益率标准差
- **THEN** 系统应用夏普比率公式
- **THEN** 系统显示比率值
- **THEN** 系统提供解释（> 1 = 良好）

#### Scenario: 显示交易频率
- **WHEN** 系统统计交易活动
- **THEN** 系统计算每日平均交易次数
- **THEN** 系统显示总交易次数
- **THEN** 系统显示活跃交易日数量

---

### Requirement: 权益曲线图表

系统应当提供交互式权益曲线图表。

#### Scenario: 绘制权益曲线
- **WHEN** 用户打开仪表板
- **THEN** 系统查询所有历史交易
- **THEN** 系统计算每个时间点的账户权益
- **THEN** 系统绘制连续的折线图
- **THEN** 图表显示盈亏变化趋势

#### Scenario: 图表交互缩放
- **WHEN** 用户拖动选择图表区域
- **THEN** 系统放大到选定时间段
- **THEN** 系统重新计算该时段统计数据
- **THEN** 用户可以双击重置缩放

#### Scenario: 图表标注重要事件
- **WHEN** 系统绘制权益曲线
- **THEN** 系统标注大额交易点
- **THEN** 系统标注最大回撤区间
- **THEN** 用户鼠标悬停显示详情
- **THEN** 用户可点击跳转到具体交易

#### Scenario: 对比基准线
- **WHEN** 用户启用基准对比
- **THEN** 系统绘制买入持有策略曲线
- **THEN** 系统同时显示两条曲线
- **THEN** 系统计算超额收益
- **THEN** 系统高亮表现差异区间

---

### Requirement: 盈亏分布分析

系统应当分析并可视化盈亏分布特征。

#### Scenario: 绘制盈亏分布直方图
- **WHEN** 用户查看盈亏分析
- **THEN** 系统统计所有交易的盈亏金额
- **THEN** 系统分组到直方图桶（bins）
- **THEN** 系统绘制频率分布直方图
- **THEN** 系统标注均值和中位数

#### Scenario: 显示盈亏比
- **WHEN** 系统计算风险收益比
- **THEN** 系统计算平均盈利金额
- **THEN** 系统计算平均亏损金额
- **THEN** 系统计算盈亏比 = 平均盈利 / 平均亏损
- **THEN** 系统显示比率和解释

#### Scenario: 最大单笔盈利/亏损
- **WHEN** 系统分析极值
- **THEN** 系统识别最大盈利交易
- **THEN** 系统识别最大亏损交易
- **THEN** 系统显示具体金额和交易详情
- **THEN** 用户可点击查看完整订单信息

#### Scenario: 盈亏时间分布
- **WHEN** 用户查看时间维度分析
- **THEN** 系统按周/月/季度聚合盈亏
- **THEN** 系统绘制柱状图
- **THEN** 系统识别盈利/亏损周期模式

---

### Requirement: 持仓概览

系统应当显示当前所有持仓的实时状态。

#### Scenario: 显示当前持仓列表
- **WHEN** 用户查看持仓概览
- **THEN** 系统查询所有未平仓位
- **THEN** 系统显示：交易对、方向、数量、入场价、当前价
- **THEN** 系统实时计算未实现盈亏
- **THEN** 系统用颜色区分盈亏状态

#### Scenario: 持仓实时更新
- **WHEN** 系统接收WebSocket价格更新
- **THEN** 系统重新计算所有持仓盈亏
- **THEN** 系统更新UI显示（无需刷新页面）
- **THEN** 系统高亮盈亏变化较大的持仓

#### Scenario: 持仓汇总统计
- **WHEN** 系统计算持仓总览
- **THEN** 系统计算总未实现盈亏
- **THEN** 系统计算持仓市值
- **THEN** 系统计算平均持仓天数
- **THEN** 系统显示持仓分布（按交易对）

---

### Requirement: 策略表现对比

系统应当支持多个策略的表现对比。

#### Scenario: 用户选择对比策略
- **WHEN** 用户选择3个策略进行对比
- **THEN** 系统查询各策略的交易记录
- **THEN** 系统并排显示关键指标
- **THEN** 系统高亮最佳表现指标
- **THEN** 系统生成对比图表

#### Scenario: 策略收益曲线对比
- **WHEN** 用户查看策略对比
- **THEN** 系统在同一图表绘制多条权益曲线
- **THEN** 每条曲线用不同颜色区分
- **THEN** 图例显示策略名称
- **THEN** 用户可切换显示/隐藏某条曲线

#### Scenario: 策略风险指标对比
- **WHEN** 系统对比策略风险
- **THEN** 系统并排显示最大回撤
- **THEN** 系统对比夏普比率
- **THEN** 系统对比波动率
- **THEN** 系统推荐风险调整后最优策略

---

### Requirement: 数据导出功能

系统应当支持导出交易数据和报表。

#### Scenario: 导出交易记录CSV
- **WHEN** 用户点击"导出数据"
- **THEN** 系统生成CSV文件包含所有交易
- **THEN** CSV包含字段：时间、交易对、方向、数量、价格、盈亏、手续费
- **THEN** 系统下载文件
- **THEN** 用户可在Excel中打开

#### Scenario: 导出PDF报告
- **WHEN** 用户请求生成PDF报告
- **THEN** 系统生成包含图表的专业报告
- **THEN** 报告包含权益曲线、统计数据、交易列表
- **THEN** 报告包含生成日期和配置参数
- **THEN** 系统下载PDF文件

#### Scenario: 定期邮件报告
- **WHEN** 用户配置每周自动报告
- **THEN** 系统每周自动生成报告
- **THEN** 系统通过邮件发送PDF附件
- **THEN** 用户无需手动操作

---

### Requirement: 实时更新机制

系统应当通过WebSocket实现仪表板数据的实时更新。

#### Scenario: 新交易实时显示
- **WHEN** 策略执行新交易
- **THEN** 系统通过WebSocket推送交易事件
- **THEN** 仪表板接收事件
- **THEN** 仪表板在交易列表顶部插入新记录
- **THEN** 仪表板更新统计数据

#### Scenario: 价格更新触发盈亏刷新
- **WHEN** 系统接收价格tick
- **THEN** 系统计算影响的持仓盈亏
- **THEN** 系统推送盈亏更新到前端
- **THEN** 仪表板更新持仓盈亏显示
- **THEN** 权益曲线实时延伸

#### Scenario: WebSocket断线重连
- **WHEN** WebSocket连接中断
- **THEN** 前端检测到断线
- **THEN** 前端实施指数退避重连
- **THEN** 重连成功后拉取错过的更新
- **THEN** 仪表板恢复实时状态

---

### Requirement: 多时间周期分析

系统应当支持不同时间粒度的性能分析。

#### Scenario: 按日/周/月/年聚合
- **WHEN** 用户选择"月度"视图
- **THEN** 系统按月聚合交易数据
- **THEN** 系统显示每月收益率
- **THEN** 系统绘制月度柱状图
- **THEN** 系统标注最佳/最差月份

#### Scenario: 环比分析
- **WHEN** 用户查看本月表现
- **THEN** 系统对比上月数据
- **THEN** 系统计算环比增长率
- **THEN** 系统显示增长箭头（上涨/下跌）
- **THEN** 系统解释变化原因

---

### Requirement: 移动端响应式设计

系统仪表板应当支持移动设备访问。

#### Scenario: 移动端适配布局
- **WHEN** 用户在手机上访问仪表板
- **THEN** 系统检测移动设备
- **THEN** 系统调整为单列布局
- **THEN** 图表自动缩放适应屏幕
- **THEN** 关键指标优先显示

#### Scenario: 触摸手势支持
- **WHEN** 用户在移动设备查看图表
- **THEN** 用户可双指缩放图表
- **THEN** 用户可滑动查看更多数据
- **THEN** 用户可点击触发详情弹窗

---

## MODIFIED Requirements（修改的需求）

_无 - 这是新增域_

---

## REMOVED Requirements（移除的需求）

_无 - 这是新增域_
